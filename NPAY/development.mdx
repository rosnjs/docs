# ðŸ”Œ API Documentation - NPAY

## Vue d'ensemble

L'API NPAY fournit une interface RESTful complÃ¨te pour intÃ©grer les fonctionnalitÃ©s de paiement dans vos applications. Elle supporte l'authentification, la gestion des transactions, les webhooks et bien plus.

## ðŸš€ DÃ©marrage Rapide

### Base URL
```
Production: https://api.npay.com/v1
Sandbox:    https://sandbox-api.npay.com/v1
```

### Authentification
```bash
# ClÃ© API dans l'en-tÃªte
curl -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     https://api.npay.com/v1/transactions
```

## ðŸ“‹ Endpoints Principaux

### ðŸ” Authentification

#### Login
```http
POST /auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "remember": true
}
```

**RÃ©ponse :**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": 1,
      "email": "user@example.com",
      "name": "John Doe"
    },
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "expires_in": 3600
  }
}
```

#### Register
```http
POST /auth/register
Content-Type: application/json

{
  "name": "John Doe",
  "email": "user@example.com",
  "password": "password123",
  "password_confirmation": "password123"
}
```

#### Logout
```http
POST /auth/logout
Authorization: Bearer YOUR_TOKEN
```

### ðŸ’³ Transactions

#### CrÃ©er une Transaction
```http
POST /transactions
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "amount": 100.00,
  "currency": "USD",
  "description": "Payment for services",
  "customer": {
    "email": "customer@example.com",
    "name": "Customer Name"
  },
  "payment_method": {
    "type": "card",
    "card": {
      "number": "4242424242424242",
      "exp_month": 12,
      "exp_year": 2025,
      "cvc": "123"
    }
  }
}
```

**RÃ©ponse :**
```json
{
  "success": true,
  "data": {
    "id": "txn_123456789",
    "amount": 100.00,
    "currency": "USD",
    "status": "pending",
    "created_at": "2024-01-15T10:30:00Z",
    "payment_url": "https://pay.npay.com/txn_123456789"
  }
}
```

#### RÃ©cupÃ©rer une Transaction
```http
GET /transactions/{id}
Authorization: Bearer YOUR_TOKEN
```

#### Lister les Transactions
```http
GET /transactions?page=1&limit=20&status=completed
Authorization: Bearer YOUR_TOKEN
```

### ðŸ’° Paiements

#### CrÃ©er un Paiement
```http
POST /payments
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "transaction_id": "txn_123456789",
  "payment_method": "stripe",
  "metadata": {
    "order_id": "order_123",
    "customer_id": "cust_456"
  }
}
```

#### Webhooks
```http
POST /webhooks/stripe
Content-Type: application/json
X-Stripe-Signature: t=1234567890,v1=signature

{
  "id": "evt_123456789",
  "type": "payment_intent.succeeded",
  "data": {
    "object": {
      "id": "pi_123456789",
      "amount": 10000,
      "currency": "usd",
      "status": "succeeded"
    }
  }
}
```

### ðŸ‘¥ Utilisateurs

#### Profil Utilisateur
```http
GET /user/profile
Authorization: Bearer YOUR_TOKEN
```

#### Mettre Ã  jour le Profil
```http
PUT /user/profile
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "phone": "+1234567890"
}
```

### ðŸª Merchants

#### CrÃ©er un Merchant
```http
POST /merchants
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "business_name": "My Business",
  "business_type": "retail",
  "website": "https://mybusiness.com",
  "contact_email": "contact@mybusiness.com"
}
```

#### Configuration Merchant
```http
GET /merchants/{id}/settings
Authorization: Bearer YOUR_TOKEN
```

### ðŸ“Š Analytics

#### Statistiques
```http
GET /analytics/overview?period=30d
Authorization: Bearer YOUR_TOKEN
```

**RÃ©ponse :**
```json
{
  "success": true,
  "data": {
    "total_transactions": 1250,
    "total_volume": 125000.00,
    "success_rate": 98.5,
    "average_transaction": 100.00,
    "period": "30d"
  }
}
```

## ðŸ”’ SÃ©curitÃ©

### Authentification

#### API Keys
```bash
# GÃ©nÃ©rer une clÃ© API
curl -X POST https://api.npay.com/v1/api-keys \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"name": "My App", "permissions": ["transactions:read", "transactions:write"]}'
```

#### JWT Tokens
```json
{
  "iss": "npay-api",
  "sub": "user_123",
  "aud": "npay-app",
  "exp": 1640995200,
  "iat": 1640908800,
  "scope": ["transactions:read", "transactions:write"]
}
```

### Rate Limiting
```http
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1640995200
```

### Webhooks SÃ©curisÃ©s

#### VÃ©rification de Signature
```php
// PHP - VÃ©rification Stripe
$payload = file_get_contents('php://input');
$sig_header = $_SERVER['HTTP_STRIPE_SIGNATURE'];
$endpoint_secret = 'whsec_...';

$event = \Stripe\Webhook::constructEvent(
    $payload, $sig_header, $endpoint_secret
);
```

```javascript
// Node.js - VÃ©rification PayPal
const crypto = require('crypto');

function verifyPayPalWebhook(headers, body, webhookId) {
  const signature = headers['paypal-transmission-sig'];
  const certId = headers['paypal-cert-id'];
  const timestamp = headers['paypal-transmission-time'];
  
  const data = `${certId}|${timestamp}|${body}`;
  const hash = crypto.createHmac('sha256', webhookSecret).update(data).digest('base64');
  
  return hash === signature;
}
```

## ðŸ“ Codes de Statut

### SuccÃ¨s
- `200 OK` - RequÃªte rÃ©ussie
- `201 Created` - Ressource crÃ©Ã©e
- `202 Accepted` - RequÃªte acceptÃ©e (traitement asynchrone)

### Erreurs Client
- `400 Bad Request` - RequÃªte malformÃ©e
- `401 Unauthorized` - Authentification requise
- `403 Forbidden` - AccÃ¨s refusÃ©
- `404 Not Found` - Ressource non trouvÃ©e
- `422 Unprocessable Entity` - DonnÃ©es invalides
- `429 Too Many Requests` - Rate limit dÃ©passÃ©

### Erreurs Serveur
- `500 Internal Server Error` - Erreur serveur
- `502 Bad Gateway` - Erreur passerelle
- `503 Service Unavailable` - Service indisponible

## ðŸ”„ Pagination

### ParamÃ¨tres
```http
GET /transactions?page=2&limit=50&sort=created_at&order=desc
```

### RÃ©ponse
```json
{
  "data": [...],
  "pagination": {
    "current_page": 2,
    "per_page": 50,
    "total": 1250,
    "last_page": 25,
    "from": 51,
    "to": 100
  },
  "links": {
    "first": "https://api.npay.com/v1/transactions?page=1",
    "last": "https://api.npay.com/v1/transactions?page=25",
    "prev": "https://api.npay.com/v1/transactions?page=1",
    "next": "https://api.npay.com/v1/transactions?page=3"
  }
}
```

## ðŸ” Filtres et Recherche

### Filtres Disponibles
```http
# Par statut
GET /transactions?status=completed

# Par date
GET /transactions?from=2024-01-01&to=2024-01-31

# Par montant
GET /transactions?amount_min=10&amount_max=1000

# Par devise
GET /transactions?currency=USD

# Recherche textuelle
GET /transactions?search=payment
```

### Tri
```http
# Tri par date (dÃ©faut)
GET /transactions?sort=created_at&order=desc

# Tri par montant
GET /transactions?sort=amount&order=asc

# Tri par statut
GET /transactions?sort=status&order=asc
```

## ðŸ“Š Webhooks

### Ã‰vÃ©nements Disponibles

#### Transactions
- `transaction.created` - Transaction crÃ©Ã©e
- `transaction.updated` - Transaction mise Ã  jour
- `transaction.completed` - Transaction terminÃ©e
- `transaction.failed` - Transaction Ã©chouÃ©e
- `transaction.cancelled` - Transaction annulÃ©e

#### Paiements
- `payment.succeeded` - Paiement rÃ©ussi
- `payment.failed` - Paiement Ã©chouÃ©
- `payment.refunded` - Paiement remboursÃ©
- `payment.disputed` - Paiement contestÃ©

#### Utilisateurs
- `user.created` - Utilisateur crÃ©Ã©
- `user.updated` - Utilisateur mis Ã  jour
- `user.deleted` - Utilisateur supprimÃ©

### Configuration Webhook
```http
POST /webhooks
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "url": "https://your-app.com/webhooks/npay",
  "events": ["transaction.completed", "payment.succeeded"],
  "secret": "your-webhook-secret"
}
```

## ðŸ§ª SDK et Exemples

### PHP SDK
```php
use NPay\NPayClient;

$client = new NPayClient('your-api-key');

// CrÃ©er une transaction
$transaction = $client->transactions()->create([
    'amount' => 100.00,
    'currency' => 'USD',
    'description' => 'Payment for services'
]);

// RÃ©cupÃ©rer une transaction
$transaction = $client->transactions()->find('txn_123456789');
```

### JavaScript SDK
```javascript
import NPay from '@npay/sdk';

const client = new NPay('your-api-key');

// CrÃ©er une transaction
const transaction = await client.transactions.create({
    amount: 100.00,
    currency: 'USD',
    description: 'Payment for services'
});

// Ã‰couter les webhooks
client.webhooks.on('transaction.completed', (event) => {
    console.log('Transaction completed:', event.data);
});
```

### Python SDK
```python
from npay import NPayClient

client = NPayClient('your-api-key')

# CrÃ©er une transaction
transaction = client.transactions.create(
    amount=100.00,
    currency='USD',
    description='Payment for services'
)

# RÃ©cupÃ©rer les transactions
transactions = client.transactions.list(limit=50)
```

## ðŸš€ IntÃ©gration

### Ã‰tapes d'IntÃ©gration

1. **CrÃ©er un compte** et obtenir vos clÃ©s API
2. **Configurer l'authentification** dans votre application
3. **ImplÃ©menter les webhooks** pour les notifications
4. **Tester en sandbox** avant la production
5. **DÃ©ployer en production** avec monitoring

### Checklist de DÃ©ploiement
- [ ] ClÃ©s API configurÃ©es
- [ ] Webhooks configurÃ©s et testÃ©s
- [ ] Gestion d'erreurs implÃ©mentÃ©e
- [ ] Logs de sÃ©curitÃ© activÃ©s
- [ ] Monitoring configurÃ©
- [ ] Tests de charge effectuÃ©s

## ðŸ“ž Support

### Ressources
- **Documentation** : [docs.npay.com](https://docs.npay.com)
- **Status Page** : [status.npay.com](https://status.npay.com)
- **Support Email** : api-support@npay.com
- **Discord** : [discord.gg/npay](https://discord.gg/npay)

### Limites et Quotas
- **Rate Limit** : 1000 requÃªtes/heure par dÃ©faut
- **Webhook Timeout** : 30 secondes
- **Payload Max** : 1MB
- **Concurrent Requests** : 100 par IP

## ðŸ§ª Tests avec Postman

### Collection Postman ComplÃ¨te

Nous fournissons une collection Postman complÃ¨te pour tester l'API NPAY :

#### Fichiers Inclus
- **`NPAY_API_Collection.postman_collection.json`** - Collection complÃ¨te des endpoints
- **`NPAY_Environment.postman_environment.json`** - Variables d'environnement
- **`POSTMAN_GUIDE.md`** - Guide d'utilisation dÃ©taillÃ©
- **`run-tests.sh`** - Script d'automatisation avec Newman
- **`newman-config.json`** - Configuration des tests

#### Installation Rapide

1. **Importer la Collection**
   ```bash
   # Dans Postman
   File > Import > NPAY_API_Collection.postman_collection.json
   ```

2. **Importer l'Environnement**
   ```bash
   # Dans Postman
   Environments > Import > NPAY_Environment.postman_environment.json
   ```

3. **Configurer les Variables**
   ```json
   {
     "base_url": "https://api.npay.com/v1",
     "user_email": "test@example.com",
     "user_password": "password123"
   }
   ```

#### Tests AutomatisÃ©s

```bash
# Tests locaux
./run-tests.sh local

# Tests sandbox
./run-tests.sh sandbox --verbose

# Tests de performance
./run-tests.sh sandbox --performance

# Tests de sÃ©curitÃ©
./run-tests.sh sandbox --security
```

#### FonctionnalitÃ©s de Test

- âœ… **Tests Automatiques** - Chaque requÃªte inclut des tests
- âœ… **Variables Dynamiques** - Sauvegarde automatique des tokens
- âœ… **Tests de Performance** - VÃ©rification des temps de rÃ©ponse
- âœ… **Tests de SÃ©curitÃ©** - Validation des headers et authentification
- âœ… **Rapports Multi-format** - HTML, JUnit, JSON
- âœ… **CI/CD Ready** - IntÃ©gration GitHub Actions, GitLab CI

#### Exemples d'Utilisation

```bash
# Test complet avec rapports
newman run NPAY_API_Collection.