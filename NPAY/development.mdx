# üîå API Documentation - NPAY

## Vue d'ensemble

L'API NPAY fournit une interface RESTful compl√®te pour int√©grer les fonctionnalit√©s de paiement dans vos applications. Elle supporte l'authentification, la gestion des transactions, les webhooks et bien plus.

## üöÄ D√©marrage Rapide

### Base URL
```
Production: https://api.npay.com/v1
Sandbox:    https://sandbox-api.npay.com/v1
```

### Authentification
```bash
# Cl√© API dans l'en-t√™te
curl -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     https://api.npay.com/v1/transactions
```

## üìã Endpoints Principaux

### üîê Authentification

#### Login
```http
POST /auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "remember": true
}
```

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": 1,
      "email": "user@example.com",
      "name": "John Doe"
    },
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "expires_in": 3600
  }
}
```

#### Register
```http
POST /auth/register
Content-Type: application/json

{
  "name": "John Doe",
  "email": "user@example.com",
  "password": "password123",
  "password_confirmation": "password123"
}
```

#### Logout
```http
POST /auth/logout
Authorization: Bearer YOUR_TOKEN
```

### üí≥ Transactions

#### Cr√©er une Transaction
```http
POST /transactions
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "amount": 100.00,
  "currency": "USD",
  "description": "Payment for services",
  "customer": {
    "email": "customer@example.com",
    "name": "Customer Name"
  },
  "payment_method": {
    "type": "card",
    "card": {
      "number": "4242424242424242",
      "exp_month": 12,
      "exp_year": 2025,
      "cvc": "123"
    }
  }
}
```

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "id": "txn_123456789",
    "amount": 100.00,
    "currency": "USD",
    "status": "pending",
    "created_at": "2024-01-15T10:30:00Z",
    "payment_url": "https://pay.npay.com/txn_123456789"
  }
}
```

#### R√©cup√©rer une Transaction
```http
GET /transactions/{id}
Authorization: Bearer YOUR_TOKEN
```

#### Lister les Transactions
```http
GET /transactions?page=1&limit=20&status=completed
Authorization: Bearer YOUR_TOKEN
```

### üí∞ Paiements

#### Cr√©er un Paiement
```http
POST /payments
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "transaction_id": "txn_123456789",
  "payment_method": "stripe",
  "metadata": {
    "order_id": "order_123",
    "customer_id": "cust_456"
  }
}
```

#### Webhooks
```http
POST /webhooks/stripe
Content-Type: application/json
X-Stripe-Signature: t=1234567890,v1=signature

{
  "id": "evt_123456789",
  "type": "payment_intent.succeeded",
  "data": {
    "object": {
      "id": "pi_123456789",
      "amount": 10000,
      "currency": "usd",
      "status": "succeeded"
    }
  }
}
```

### üë• Utilisateurs

#### Profil Utilisateur
```http
GET /user/profile
Authorization: Bearer YOUR_TOKEN
```

#### Mettre √† jour le Profil
```http
PUT /user/profile
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "phone": "+1234567890"
}
```

### üè™ Merchants

#### Cr√©er un Merchant
```http
POST /merchants
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "business_name": "My Business",
  "business_type": "retail",
  "website": "https://mybusiness.com",
  "contact_email": "contact@mybusiness.com"
}
```

#### Configuration Merchant
```http
GET /merchants/{id}/settings
Authorization: Bearer YOUR_TOKEN
```

### üìä Analytics

#### Statistiques
```http
GET /analytics/overview?period=30d
Authorization: Bearer YOUR_TOKEN
```

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "total_transactions": 1250,
    "total_volume": 125000.00,
    "success_rate": 98.5,
    "average_transaction": 100.00,
    "period": "30d"
  }
}
```

## üîí S√©curit√©

### Authentification

#### API Keys
```bash
# G√©n√©rer une cl√© API
curl -X POST https://api.npay.com/v1/api-keys \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"name": "My App", "permissions": ["transactions:read", "transactions:write"]}'
```

#### JWT Tokens
```json
{
  "iss": "npay-api",
  "sub": "user_123",
  "aud": "npay-app",
  "exp": 1640995200,
  "iat": 1640908800,
  "scope": ["transactions:read", "transactions:write"]
}
```

### Rate Limiting
```http
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1640995200
```

### Webhooks S√©curis√©s

#### V√©rification de Signature
```php
// PHP - V√©rification Stripe
$payload = file_get_contents('php://input');
$sig_header = $_SERVER['HTTP_STRIPE_SIGNATURE'];
$endpoint_secret = 'whsec_...';

$event = \Stripe\Webhook::constructEvent(
    $payload, $sig_header, $endpoint_secret
);
```

```javascript
// Node.js - V√©rification PayPal
const crypto = require('crypto');

function verifyPayPalWebhook(headers, body, webhookId) {
  const signature = headers['paypal-transmission-sig'];
  const certId = headers['paypal-cert-id'];
  const timestamp = headers['paypal-transmission-time'];
  
  const data = `${certId}|${timestamp}|${body}`;
  const hash = crypto.createHmac('sha256', webhookSecret).update(data).digest('base64');
  
  return hash === signature;
}
```

## üìù Codes de Statut

### Succ√®s
- `200 OK` - Requ√™te r√©ussie
- `201 Created` - Ressource cr√©√©e
- `202 Accepted` - Requ√™te accept√©e (traitement asynchrone)

### Erreurs Client
- `400 Bad Request` - Requ√™te malform√©e
- `401 Unauthorized` - Authentification requise
- `403 Forbidden` - Acc√®s refus√©
- `404 Not Found` - Ressource non trouv√©e
- `422 Unprocessable Entity` - Donn√©es invalides
- `429 Too Many Requests` - Rate limit d√©pass√©

### Erreurs Serveur
- `500 Internal Server Error` - Erreur serveur
- `502 Bad Gateway` - Erreur passerelle
- `503 Service Unavailable` - Service indisponible

## üîÑ Pagination

### Param√®tres
```http
GET /transactions?page=2&limit=50&sort=created_at&order=desc
```

### R√©ponse
```json
{
  "data": [...],
  "pagination": {
    "current_page": 2,
    "per_page": 50,
    "total": 1250,
    "last_page": 25,
    "from": 51,
    "to": 100
  },
  "links": {
    "first": "https://api.npay.com/v1/transactions?page=1",
    "last": "https://api.npay.com/v1/transactions?page=25",
    "prev": "https://api.npay.com/v1/transactions?page=1",
    "next": "https://api.npay.com/v1/transactions?page=3"
  }
}
```

## üîç Filtres et Recherche

### Filtres Disponibles
```http
# Par statut
GET /transactions?status=completed

# Par date
GET /transactions?from=2024-01-01&to=2024-01-31

# Par montant
GET /transactions?amount_min=10&amount_max=1000

# Par devise
GET /transactions?currency=USD

# Recherche textuelle
GET /transactions?search=payment
```

### Tri
```http
# Tri par date (d√©faut)
GET /transactions?sort=created_at&order=desc

# Tri par montant
GET /transactions?sort=amount&order=asc

# Tri par statut
GET /transactions?sort=status&order=asc
```

## üìä Webhooks

### √âv√©nements Disponibles

#### Transactions
- `transaction.created` - Transaction cr√©√©e
- `transaction.updated` - Transaction mise √† jour
- `transaction.completed` - Transaction termin√©e
- `transaction.failed` - Transaction √©chou√©e
- `transaction.cancelled` - Transaction annul√©e

#### Paiements
- `payment.succeeded` - Paiement r√©ussi
- `payment.failed` - Paiement √©chou√©
- `payment.refunded` - Paiement rembours√©
- `payment.disputed` - Paiement contest√©

#### Utilisateurs
- `user.created` - Utilisateur cr√©√©
- `user.updated` - Utilisateur mis √† jour
- `user.deleted` - Utilisateur supprim√©

### Configuration Webhook
```http
POST /webhooks
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "url": "https://your-app.com/webhooks/npay",
  "events": ["transaction.completed", "payment.succeeded"],
  "secret": "your-webhook-secret"
}
```

## üß™ SDK et Exemples

### PHP SDK
```php
use NPay\NPayClient;

$client = new NPayClient('your-api-key');

// Cr√©er une transaction
$transaction = $client->transactions()->create([
    'amount' => 100.00,
    'currency' => 'USD',
    'description' => 'Payment for services'
]);

// R√©cup√©rer une transaction
$transaction = $client->transactions()->find('txn_123456789');
```

### JavaScript SDK
```javascript
import NPay from '@npay/sdk';

const client = new NPay('your-api-key');

// Cr√©er une transaction
const transaction = await client.transactions.create({
    amount: 100.00,
    currency: 'USD',
    description: 'Payment for services'
});

// √âcouter les webhooks
client.webhooks.on('transaction.completed', (event) => {
    console.log('Transaction completed:', event.data);
});
```

### Python SDK
```python
from npay import NPayClient

client = NPayClient('your-api-key')

# Cr√©er une transaction
transaction = client.transactions.create(
    amount=100.00,
    currency='USD',
    description='Payment for services'
)

# R√©cup√©rer les transactions
transactions = client.transactions.list(limit=50)
```

## üöÄ Int√©gration

### √âtapes d'Int√©gration

1. **Cr√©er un compte** et obtenir vos cl√©s API
2. **Configurer l'authentification** dans votre application
3. **Impl√©menter les webhooks** pour les notifications
4. **Tester en sandbox** avant la production
5. **D√©ployer en production** avec monitoring

### Checklist de D√©ploiement
- [ ] Cl√©s API configur√©es
- [ ] Webhooks configur√©s et test√©s
- [ ] Gestion d'erreurs impl√©ment√©e
- [ ] Logs de s√©curit√© activ√©s
- [ ] Monitoring configur√©
- [ ] Tests de charge effectu√©s

## üìû Support

### Ressources
- **Documentation** : [docs.npay.com](https://docs.npay.com)
- **Status Page** : [status.npay.com](https://status.npay.com)
- **Support Email** : api-support@npay.com
- **Discord** : [discord.gg/npay](https://discord.gg/npay)

### Limites et Quotas
- **Rate Limit** : 1000 requ√™tes/heure par d√©faut
- **Webhook Timeout** : 30 secondes
- **Payload Max** : 1MB
- **Concurrent Requests** : 100 par IP

## üß™ Tests avec Postman

### Collection Postman Compl√®te

Nous fournissons une collection Postman compl√®te pour tester l'API NPAY :

#### Fichiers Inclus
- **`NPAY_API_Collection.postman_collection.json`** - Collection compl√®te des endpoints
- **`NPAY_Environment.postman_environment.json`** - Variables d'environnement
- **`POSTMAN_GUIDE.md`** - Guide d'utilisation d√©taill√©
- **`run-tests.sh`** - Script d'automatisation avec Newman
- **`newman-config.json`** - Configuration des tests

#### Installation Rapide

1. **Importer la Collection**
   ```bash
   # Dans Postman
   File > Import > NPAY_API_Collection.postman_collection.json
   ```

2. **Importer l'Environnement**
   ```bash
   # Dans Postman
   Environments > Import > NPAY_Environment.postman_environment.json
   ```

3. **Configurer les Variables**
   ```json
   {
     "base_url": "https://api.npay.com/v1",
     "user_email": "test@example.com",
     "user_password": "password123"
   }
   ```

#### Tests Automatis√©s

```bash
# Tests locaux
./run-tests.sh local

# Tests sandbox
./run-tests.sh sandbox --verbose

# Tests de performance
./run-tests.sh sandbox --performance

# Tests de s√©curit√©
./run-tests.sh sandbox --security
```

#### Fonctionnalit√©s de Test

- ‚úÖ **Tests Automatiques** - Chaque requ√™te inclut des tests
- ‚úÖ **Variables Dynamiques** - Sauvegarde automatique des tokens
- ‚úÖ **Tests de Performance** - V√©rification des temps de r√©ponse
- ‚úÖ **Tests de S√©curit√©** - Validation des headers et authentification
- ‚úÖ **Rapports Multi-format** - HTML, JUnit, JSON
- ‚úÖ **CI/CD Ready** - Int√©gration GitHub Actions, GitLab CI

#### Exemples d'Utilisation

```bash
# Test complet avec rapports
newman run NPAY_API_Collection.